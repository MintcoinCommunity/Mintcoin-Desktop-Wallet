language: cpp

install:
  # Travis already has OpenSSL and Boost installed via Homebrew, but we
  # need to add a couple more packages
  - if [ $TRAVIS_OS_NAME = osx ]; then
      brew upgrade ;
      brew install miniupnpc berkeley-db@4 ;
    fi
  # We need this for our push to MEGA.nz
  - pip install --user mega.py

env:
  secure: "p/AYMGogBGHUXlT5XB+x0QMQ4efyC67D2MBz49bXqZ7CA7pOdNmXnK8bscf2Mu4UJvz0/d8Q6J8NJ1IhRPPZ6qFWuihPqLOWxUj2kCnWd1STpR8RR//v5P0yJ7bFj4ta/JaUC0I0dgZUTdfvjyOIS9TkVZB8G5bNTFpUsYt7ZQWinGVAKsUP8Q/3Qvq89ib+9p6i+3FDysn4XxiWHaJ4hPJe16wzCBp2elnICqq/vxo8J62qFbnOLgICkILirBtaEj1+hyIpods/QBlxIlDrjmVrd+2NGS74qjfoouc6ur9wUPKescBplFg99Rqq/jYq4FcHlK0pA0l+szxCv8a/NFrepy8d1y4oyKWoaEWh0bdOy/3yeNmtGEyrGKd73umxIGiRLyJE9z37pfv1VmSsgtrhYwRwzvQvvUXHi4vDl27wZ+A7sKa4J8WoLhTtkCarny2FntOBRm2pd7VvleWDBIPVPKV2LgEb2GOEhdf1jwCT9uPvpI8RZ+S1AGmvdIrSVgCOR56j3nTV4R1514EM9h5zPdBejiInhULBNfe/dPuIhldR4UzYvvQ0dV1Byiq+KqoGGoSfNQwjy1pus5exfQgWqA9da6aoVV+XdfTWRGnQGHXL+Ks/Iw5v5ygCpbKslImXTTFbfcc95s7mtI8E75lC8nFxhpuWSzkltKLxlpA="

# These encode our MEGA user and password, as MEGA_EMAIL and MEGA_PASSWORD.
matrix:
  include:
  # Build mintcoind
  # Cross-compile Windows 32-bit daemon
  - os: linux
    dist: xenial
    sudo: required
    script: bash src/mxe-build.sh windows32
    after_script: python src/mega-copy.py src/mintcoind.exe $TRAVIS_BRANCH/mintcoind.exe.win32

  # Build mintcoind static
  # Ubuntu 16.04 LTS (Xenial Xerus) is our latest Ubuntu version
  - os: linux
    dist: xenial
    sudo: required
    addons:
      apt:
        packages:
          - libdb++-dev
          - libboost-all-dev
          - libqrencode-dev
          - libminiupnpc-dev
    script: cd src && make -f makefile.unix -j2 STATIC="all" LDFLAGS="-static"
    after_script: python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.linux64-ubuntu-trusty.static

  # Build mintcoind static
  # Ubuntu 16.04 LTS (Xenial Xerus) is our latest Ubuntu version
  # Make a 32-bit version using Debian multiarch
  - os: linux
    dist: xenial
    sudo: required
    # To support 32-bit builds, we add the i386 architecture to
    # Ubuntu, and then install 32-bit versions of the compiler and
    # libraries needed. For details of Debian multiarch see the wiki:
    #
    # https://wiki.debian.org/Multiarch
    #
    # Even with multiarch support, we have to do a bit of a dance.
    #
    # apt-get does not seem to understand dependencies for the
    # multiarch stuff, so we have to explicitly install all of the
    # dependencies.
    before_script:
        - sudo dpkg --add-architecture i386
        - sudo apt-get update
        - sudo apt-get install -y g++:i386 cpp:i386 gcc:i386 cpp-5:i386 gcc-5:i386 binutils:i386
        - sudo apt-get install -y libssl-dev:i386
        - sudo apt-get install -y libdb++-dev:i386
        - sudo apt-get install -y libminiupnpc-dev:i386
        - sudo apt-get install -y openmpi-common:i386
        - sudo apt-get install -y libboost-all-dev:i386 libboost-mpi-dev:i386 libboost-mpi-python-dev:i386 libboost-python-dev:i386 libboost-python1.58-dev:i386 python:i386
    script: cd src && make -f makefile.unix -j2 STATIC="all" LDFLAGS="-static"
    after_script:
        - sudo apt-get install -y python:amd64
        - sudo apt-get install python-requests
        - python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.linux32-ubuntu-trusty.static

  # Build mintcoind static
  # OS X 10.11 (El Capitan)
  - os: osx
    osx_image: xcode8
    script: cd src && make -f makefile.osx -j2 STATIC="all" LDFLAGS="-static"
    after_script: python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.osx-elcapitan.static

  # Build MintCoin-Qt
  # Cross-compile Windows 32-bit GUI
  - os: linux
    dist: xenial
    sudo: required
    script: bash src/mxe-build.sh windows32-qt
    after_script: python src/mega-copy.py release/MintCoin-Qt.exe $TRAVIS_BRANCH/MintCoin-Qt.exe.win32
