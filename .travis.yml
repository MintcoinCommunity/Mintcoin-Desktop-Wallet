language: cpp

install:
  # Travis already has OpenSSL and Boost installed via Homebrew, but we
  # need to add a couple more packages
  - if [ $TRAVIS_OS_NAME = osx ]; then
      brew upgrade ;
      brew install miniupnpc berkeley-db@4 ;
    fi
  # We need this for our push to MEGA.nz
  - pip install --user mega.py

env:
  - secure: "pNja1Y/1caWd4pqpn1AS5r6M1HmDZRmY85s54+xC86v6XyG0HRPNVAkMJrH5DUd9OJTW71CLsC0pHYu2m/h4sjm3M2oeZw3w5zm53isAXLQRrlVFGJUEMFWjV0NimfzaCswfEabR3hqGTAefC5RL028f7SxNT/SWXmXawZJRBZahKo1Th53XIX+jl5FAavUWGQfKYdclOMek4q4mZaVTNGfpVcduJq/JuesAA3iNCHajPAIyuV0ZkMkGrP4zseeGYRt5hyBEjjmWj458ME21pxuaST4vjjjYAwPsEmwU7CMqPp4KxCxgIAxShdxB9OdIBQydn+MNNtRN9Md6QEzbY0YWcKSE3utJZDr5ro8OmBJszF0ygUW69Tii2Fez2rIoMFMhIpKn/PiUrHAMMmaoOvf5fs+pzeDSa7rSN7kczTUBlzqyGvpm/G3sd8dF2wEa/f13NN3bP4UE8Qa4OUJcI2DMbV6ROuJLzTtsd8b8JwNmL17z+G3VXvzeUeS2tacD/iBNA9SxBU7Bn5YxbKt8NJsTMCI0AtdPQQtdab1MpURFT3tip71WVosrOZnPdCSBCEBg4iVfcP12wb8n8uwrJlwI91IRNoD473SpCtwqxKh/mO3tFS/IFIliDlGdb01OGnCgLs2anNus1vg7NtfObHdKC+r5tnrH/eMjXvufBvs="

# These encode our MEGA user and password, as MEGA_EMAIL and MEGA_PASSWORD.
matrix:
  include:
  # Build mintcoind
  # Ubuntu 14.04 LTS (Trusty Tahr) is our latest (and only) Ubuntu version
  - os: linux
    dist: trusty
    sudo: required
    addons:
      apt:
        packages:
          - libdb++-dev
          - libboost-all-dev
          - libqrencode-dev
          - libminiupnpc-dev
          - libminiupnpc8
    script: cd src && make -f makefile.unix -j2 && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.linux-ubuntu-trusty

  # Build mintcoind
  # Cross-compile Windows 32-bit daemon
  - os: linux
    dist: trusty
    sudo: required
    script: bash src/mxe-build.sh windows32 && python src/mega-copy.py src/mintcoind.exe $TRAVIS_BRANCH/mintcoind.exe.win32

  # Build mintcoind
  # Cross-compile Windows 64-bit daemon
  - os: linux
    dist: trusty
    sudo: required
    script: bash src/mxe-build.sh windows64 && python src/mega-copy.py src/mintcoind.exe $TRAVIS_BRANCH/mintcoind.exe.win64

  # Build mintcoind static
  # Ubuntu 14.04 LTS (Trusty Tahr) is our latest (and only) Ubuntu version
  - os: linux
    dist: trusty
    sudo: required
    addons:
      apt:
        packages:
          - libdb++-dev
          - libboost-all-dev
          - libqrencode-dev
          - libminiupnpc-dev
          - libminiupnpc8
    script: cd src && make -f makefile.unix -j2 STATIC="all" LDFLAGS="-static" && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.linux-ubuntu-trusty.static

  # Build mintcoind
  # Ubuntu 16.04 LTS (Xenial Xerus) not supported yet
  #- os: linux
  #  dist: xenial
  #  sudo: required
  #  addons:
  #    apt:
  #      packages:
  #        - libdb++-dev
  #        - libboost-all-dev
  #        - libqrencode-dev
  #        - libminiupnpc-dev
  #        - libminiupnpc8
  #  script: cd src && make -f makefile.unix -j2 && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.linux-ubuntu-xenial

  # Build mintcoind
  # OS X 10.10 (Yosemite)
  #
  # "pip: command not found" on Travis, so we will just not build this

  # Build mintcoind static
  # OS X 10.10 (Yosemite)
  #
  # "pip: command not found" on Travis, so we will just not build this

  # Build mintcoind
  # OS X 10.11 (El Capitan)
  - os: osx
    osx_image: xcode7.3
    script: cd src && make -f makefile.osx -j2 && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.osx-elcapitan

  # Build mintcoind static
  # OS X 10.11 (El Capitan)
  - os: osx
    osx_image: xcode7.3
    script: cd src && make -f makefile.osx -j2 STATIC="all" LDFLAGS="-static" && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.osx-elcapitan.static

  # Build mintcoind
  # OS X 10.12 (Sierra)
  - os: osx
    osx_image: xcode8.3
    script: cd src && make -f makefile.osx -j2 && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.macos-sierra

  # Build mintcoind static
  # OS X 10.12 (Sierra)
  - os: osx
    osx_image: xcode8.3
    script: cd src && make -f makefile.osx -j2 STATIC="all" LDFLAGS="-static" && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.macos-sierra.static

  # Build mintcoind
  # OS X 10.13 (High Sierra)
  - os: osx
    osx_image: xcode9.3beta
    script: cd src && make -f makefile.osx -j2 && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.macos-highsierra

  # Build mintcoind static
  # OS X 10.13 (High Sierra)
  - os: osx
    osx_image: xcode9.3beta
    script: cd src && make -f makefile.osx -j2 STATIC="all" LDFLAGS="-static" && python mega-copy.py mintcoind $TRAVIS_BRANCH/mintcoind.macos-highsierra.static

  # Build MintCoin-Qt
  # Ubuntu 14.04 LTS (Trusty Tahr) is our latest (and only) Ubuntu version
  - os: linux
    dist: trusty
    sudo: required
    addons:
      apt:
        packages:
          - libdb++-dev
          - libboost-all-dev
          - libqrencode-dev
          - libminiupnpc-dev
          - libminiupnpc8
          - qt4-qmake
          - libqt4-dev
    script: qmake && make -j2 && python src/mega-copy.py MintCoin-Qt $TRAVIS_BRANCH/MintCoin-Qt.linux-ubuntu-trusty

  # Build MintCoin-Qt
  # Ubuntu 16.04 LTS (Xenial Xerus) not supported yet
  #- os: linux
  #  dist: xenial
  #  addons:
  #    apt:
  #      packages:
  #        - libdb++-dev
  #        - libboost-all-dev
  #        - libqrencode-dev
  #        - libminiupnpc-dev
  #        - libminiupnpc8
  #        - qt4-qmake
  #        - libqt4-dev
  #  script: qmake && make -j2 && python src/mega-copy.py MintCoin-Qt $TRAVIS_BRANCH/MintCoin-Qt.linux-ubuntu-xenial

  # Build MintCoin-Qt
  # Cross-compile Windows 32-bit GUI
  - os: linux
    dist: trusty
    sudo: required
    script: bash src/mxe-build.sh windows32-qt && python src/mega-copy.py release/MintCoin-Qt.exe $TRAVIS_BRANCH/MintCoin-Qt.exe.win32

  # Build MintCoin-Qt
  # Cross-compile Windows 64-bit GUI
  - os: linux
    dist: trusty
    sudo: required
    script: bash src/mxe-build.sh windows64-qt && python src/mega-copy.py release/MintCoin-Qt.exe $TRAVIS_BRANCH/MintCoin-Qt.exe.win64

  # Build MintCoin-Qt
  # OS X 10.10 (Yosemite)
  #  
  #   Error: You are using macOS 10.10.
  #   We (and Apple) do not provide support for this old version.
  #   You may encounter build failures or other breakages.

  # Build MintCoin-Qt
  # OS X 10.11 (El Capitan)
  - os: osx
    osx_image: xcode7.3
    script: brew install qrencode qt && ls /usr/local/opt/qt && /usr/local/opt/qt/bin/qmake && make -j2 && python src/mega-copy.py MintCoin-Qt.app/Contents/MacOS/MintCoin-Qt $TRAVIS_BRANCH/MintCoin-Qt.osx-elcapitan

  # Build MintCoin-Qt
  # OS X 10.12 (Sierra)
  - os: osx
    osx_image: xcode8.3
    script: brew install qrencode qt && ls /usr/local/opt/qt && /usr/local/opt/qt/bin/qmake && make -j2 && python src/mega-copy.py MintCoin-Qt.app/Contents/MacOS/MintCoin-Qt $TRAVIS_BRANCH/MintCoin-Qt.macos-sierra

  # Build MintCoin-Qt
  # OS X 10.13 (High Sierra)
  - os: osx
    osx_image: xcode9.3beta
    script: brew install qrencode qt && ls /usr/local/opt/qt && /usr/local/opt/qt/bin/qmake && make -j2 && python src/mega-copy.py MintCoin-Qt.app/Contents/MacOS/MintCoin-Qt $TRAVIS_BRANCH/MintCoin-Qt.macos-highsierra
